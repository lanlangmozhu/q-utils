---
name: qh5-utils-project
description: qh5-utils 项目开发规则和规范
globs: 
alwaysApply: true
---

# qh5-utils 项目开发规则

## 1. 技术栈规范

### 1.1 基础开发环境
- 使用 `pnpm` 作为包管理器（**必须**，不要使用 npm 或 yarn）
- 使用 `TypeScript` 进行开发
- 使用 `ESM` 模块化规范
- **不引用任何第三方库**（保持独立性）

### 1.2 构建工具
- 使用 `rollup` 进行打包
- 使用 `rollup-plugin-typescript2` 生成类型定义
- 使用 `rollup-plugin-dts` 生成TS类声明文件
- 使用 `rollup-plugin-terser` 进行代码压缩
- 使用 `rollup-plugin-commonjs` 处理 CommonJS 模块
- 使用 `rollup-plugin-node-resolve` 进行模块解析

### 1.3 代码质量工具
- 使用 `prettier` 进行代码格式化
- 使用 `eslint` 进行代码检查
- 使用 `typedoc` 生成文档
- 使用 `jest` 进行单元测试

## 2. 代码组织规范

### 2.1 文件组织
- 按功能模块分类组织文件
- 每个文件只包含一个功能
- 文件必须包含完整的类型定义
- 保持文件结构清晰，避免过度嵌套

### 2.2 文件大小标准
- **理想范围**：100-300 行
- **函数数量**：每个文件 5-15 个函数
- **避免过度拆分**：小于 100 行且少于 5 个函数的文件应合并到相关文件
- **避免过度集中**：大于 400 行或超过 25 个函数的文件应拆分为多个文件

### 2.3 文件命名规范
- **功能分类命名**：当函数数量 > 5 时使用（如 `basic.ts`, `transform.ts`, `validate.ts`）
- **具体功能命名**：当函数数量 ≤ 5 时使用（如 `hexToRgb.ts`, `rgbToHex.ts`, `adjustColor.ts`）
- **描述性命名**：用于特定领域（如 `browser.ts`, `device.ts`）

### 2.4 代码注释规范
每个函数必须包含以下注释：
- 功能说明
- 参数说明
- 返回值说明
- 使用示例
- 注意事项（如果有）
- 更新记录（如果有）

### 2.5 功能模块分类
1. 数组相关（array）
2. 浏览器和设备检测（browser）
3. 颜色相关（color）
4. 日期相关（date）
5. DOM操作相关（dom）
6. 文件操作相关（file）
7. 函数相关（function）
8. 网络操作相关（network）
9. 数字相关（number）
10. 对象相关（object）
11. 存储管理相关（storage）
12. 字符串相关（string）
13. 通用工具（utils）- 已分散到各模块
14. 类型检测相关（type）
15. 空值检测相关（empty）
16. 布尔值相关（boolean）
17. Promise相关（promise）
18. 正则表达式相关（regexp）
19. 错误处理相关（error）
20. Symbol相关（symbol）
21. BigInt相关（bigint）

## 3. 文档维护规范

### 3.1 文档更新要求
当更新源代码时，必须同步更新以下文档：
1. 对应功能测试用例（`src/[module]/__tests__/`）
2. 对应功能的文档（`src/[module]/README.md`）
3. 使用示例（`examples/index.html`）
4. 功能导出说明
5. README.md
6. 使用指南（`docs/USAGE.md`）
7. 项目总结（`docs/SUMMARY.md`）

### 3.2 文档内容要求
- README.md 更新内容：
  - 功能导出说明
  - 使用示例更新
  - 新功能说明

- USAGE.md 更新内容：
  - 功能导出说明
  - 使用示例更新
  - 目录更新

- SUMMARY.md 更新内容：
  - 功能导出说明
  - 使用示例更新
  - 工具函数实现说明
  - 功能扩展说明

### 3.3 变更记录维护
- CHANGELOG.md：记录功能更新内容

## 4. 测试规范

### 4.1 单元测试要求
- 每个功能必须有对应的单元测试
- 测试用例必须覆盖主要功能点
- 测试用例必须包含边界条件
- 测试用例必须包含错误处理

### 4.2 测试文件组织
- 测试文件位于 `src/[module]/__tests__/` 目录
- 测试文件命名：`*.test.ts`（不是 `.spec.ts`）
- 测试文件应与源文件结构对应

### 4.3 测试环境
- 使用 `jsdom` 环境（支持 DOM API）
- 使用 `ts-jest` 进行 TypeScript 测试
- 测试文件使用 `@/` 别名导入

## 5. 命名规范

### 5.1 函数命名冲突处理
当发生函数命名冲突时：
1. 检查功能是否相同
   - 相同：直接引用已实现的方法
   - 不同：修改当前方法名称

### 5.2 命名规则
- 函数名：使用驼峰命名法（camelCase）
- 类名：使用帕斯卡命名法（PascalCase）
- 常量：使用大写下划线命名法（UPPER_SNAKE_CASE）
- 私有属性：使用下划线前缀（_privateProperty）

## 6. 代码质量规范

### 6.1 代码风格
- 遵循 TypeScript 最佳实践
- 保持代码简洁清晰
- 避免重复代码
- 合理使用设计模式

### 6.2 代码导出规范
- **允许混用** `export function` 和 `export const`（箭头函数）
- `export function` 适用于需要函数提升、调试友好性或常规逻辑的场景
- `export const`（箭头函数）适用于需要词法 this 绑定、防止重新赋值或模块化导出的场景
- 生成器函数使用 `export function*`
- 异步函数使用 `export async function`
- 类定义使用 `export class`

### 6.3 性能优化
- 避免不必要的计算
- 优化循环和递归
- 合理使用缓存
- 注意内存使用

### 6.4 安全性
- 输入验证
- 类型检查
- 错误处理
- 安全的数据处理

## 7. 模块导出规范

### 7.1 模块导出模式
模块的 `index.ts` 通过 `export *` 导出子模块：
```typescript
// src/array/index.ts
export * from './basic';
export * from './compare';
export * from './transform';
```

### 7.2 主入口导出模式
主入口使用命名空间导出：
```typescript
// src/index.ts
import * as array from './array';
import * as string from './string';
export { array, string, ... };
export default { array, string, ... };
```

### 7.3 命名空间导入（推荐）
```typescript
import { string, array, func } from 'qh5-utils';
string.capitalize('hello');
```

### 7.4 按需导入
```typescript
import { capitalize } from 'qh5-utils/string';
```

## 8. 类型安全规范

### 8.1 TypeScript 配置
- 使用严格模式（`strict: true`）
- 目标版本：ES2022
- 模块系统：ESNext
- 完整的类型定义

### 8.2 类型处理
- 所有函数必须有完整的类型定义
- 支持泛型，提供类型推导
- 处理 `null` 和 `undefined` 的情况
- 使用类型守卫确保类型安全

## 9. 文档注释规范

### 9.1 模块文档
所有模块的 `index.ts` 必须包含 `@packageDocumentation`：
```typescript
/**
 * 模块名称工具函数
 * @packageDocumentation
 */
```

### 9.2 函数文档
每个函数必须包含完整的 JSDoc 注释（使用中文）：
```typescript
/**
 * 功能描述
 * @param param - 参数说明
 * @returns 返回值说明
 * @example
 * ```typescript
 * functionName('example')
 * // 返回结果
 * ```
 */
```

## 10. 版本管理规范

### 10.1 版本号规则
- 主版本号：不兼容的 API 修改
- 次版本号：向下兼容的功能性新增
- 修订号：向下兼容的问题修正

### 10.2 分支管理
- main：主分支
- develop：开发分支
- feature/*：功能分支
- bugfix/*：修复分支
- release/*：发布分支

### 10.3 提交信息规范
- feat：新功能
- fix：修复问题
- docs：文档更新
- style：代码格式
- refactor：重构
- test：测试相关
- chore：构建过程或辅助工具的变动

## 11. 发布规范

### 11.1 发布前检查
- 所有测试通过
- 文档更新完整
- 示例运行正常
- 版本号更新
- CHANGELOG 更新

### 11.2 发布流程
1. 更新版本号
2. 运行完整测试
3. 生成构建文件
4. 更新文档
5. 提交代码
6. 创建标签
7. 发布包

### 11.3 发布后确认
- 包安装测试
- 功能可用性确认
- 文档可访问性确认
- 示例可运行性确认

## 12. 项目文档规范

### 12.1 文档文件管理
- **不要随意创建新的 MD 文件**
- 已完成的工作文档应合并到 `PROJECT_UPDATES.md`
- 待完成的任务应添加到 `TODO.md`
- 规则和要求应添加到 `.cursor/rules/` 目录和 `.github/copilot-instructions.md`

### 12.2 保留的核心文档
- `README.md` - 项目说明
- `CHANGELOG.md` - 功能更新记录
- `CONTRIBUTING.md` - 贡献指南
- `PUBLISHING.md` - 发布指南
- `TODO.md` - 待办任务清单
- `PROJECT_UPDATES.md` - 项目更新记录（包含所有已完成的工作）

### 12.3 文档位置
- 模块文档：`src/[module]/README.md`
- 项目文档：`docs/` 目录
- 使用示例：`examples/index.html`
- AI 编码指南：`.github/copilot-instructions.md`
- Cursor 规则：`.cursor/rules/` 目录
